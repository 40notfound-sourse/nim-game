<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ‹ãƒ ã‚²ãƒ¼ãƒ </title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      text-align: center;
      background: #f7f7f7;
    }
    h1 { color: #333; }
    .setup {
      margin: 50px auto;
      padding: 50px;
    }
    h2 { color: #333; }
    .setup {
      margin: 20px auto;
      padding: 20px;
    }
    input {
      width: 150px;
      text-align: center;
    }
    button {
      padding: 10px 30px;
      margin-top: 5px;
      cursor: pointer;
      border-radius: 8px;
      border: none;
      background: #0078d7;
      color: white;
      transition: background 0.2s;
    }
    button:hover {
      background: #005fa3;
    }
    .pile {
      margin: 10px;
    }
    .stone {
      display: inline-block;
      width: 50px;
      height: 50px;
      border-radius: 70%;
      background-color: #ff6b6b;
      margin: 10px;
      cursor: pointer;
      transition: transform 10s;
    }
    .stone:hover {
      transform: scale(1.2);
      background-color: #ff4444;
    }
  </style>
</head>
<body>
  <h1>ãƒ‹ãƒ ã‚²ãƒ¼ãƒ </h1>

  <div class="setup">
    <label>å±±ã®æ•°: <input id="pileCount" type="number" value="3" min="1"></label><br>
    <label>å„å±±ã®åˆæœŸçŸ³æ•°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰:<input id="pileSizes" type="text" value="3,4,5"></label><br>
    <label><input type="radio" name="firstTurn" value="player" checked>ã‚ãªãŸãŒå…ˆæ”»</label>
    <label><input type="radio" name="firstTurn" value="computer">ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒå…ˆæ”»</label><br>
    <button onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
  </div>

  <h2 id="message">è¨­å®šã‚’å…¥åŠ›ã—ã¦ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚ˆã†ï¼</h2>
  <div id="gameArea"></div>

  <script>
    let piles = [];
    let playerTurn = true;

    function startGame() {
      const count = parseInt(document.getElementById("pileCount").value);
      const sizes = document.getElementById("pileSizes").value
        .split(",")  .map(s => parseInt(s.trim()));

      if (sizes.length !== count || sizes.some(isNaN)) {
        alert("å±±ã®æ•°ã¨çŸ³æ•°ã®å…¥åŠ›ãŒä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“ã€‚");
        return;
      }

      piles = sizes;
      const turn =document.querySelector('input[name="firstTurn"]:checked').value;
      playerTurn = (turn==="player");

      document.getElementById("message").innerText = playerTurn ? "ã‚ãªãŸã®ç•ªã§ã™ã€‚" : "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®ç•ªã§ã™ã€‚";
      render();
      if (!playerTurn) {
        setTimeout(computerMove, 3000);
    }
    }

    function render() {
      const area = document.getElementById("gameArea");
      area.innerHTML = "";

      piles.forEach((count, i) => {
        const pileDiv = document.createElement("div");
        pileDiv.className = "pile";

        const label = document.createElement("div");
        label.innerText = "å±± " + (i + 1) + "ï¼ˆ" + count + " å€‹ï¼‰";
        pileDiv.appendChild(label);

        for (let j = 0; j < count; j++) {
          const stone = document.createElement("div");
          stone.className = "stone";
          stone.onclick = () => handlePlayerMove(i, count - j);
          pileDiv.appendChild(stone);
        }

        area.appendChild(pileDiv);
      });
    }

    function handlePlayerMove(pileIndex, removeCount) {
      if (!playerTurn) return;
      if (piles[pileIndex] < removeCount) return;

      piles[pileIndex] -= removeCount;
      playerTurn = false;
      render();

      if (isGameOver()) {
        document.getElementById("message").innerText = "ã‚ãªãŸã®å‹ã¡ï¼ğŸ‰";
        return;
      }

      document.getElementById("message").innerText = "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®ç•ªã§ã™â€¦";
      setTimeout(computerMove, 2000);
    }

    function computerMove() {
      let xorSum = piles.reduce((a, b) => a ^ b, 0);
      let pileIndex = -1;
      let removeCount = 0;

      for (let i = 0; i < piles.length; i++) {
        let target = piles[i] ^ xorSum;
        if (target < piles[i]) {
          pileIndex = i;
          removeCount = piles[i] - target;
          break;
        }
      }

      // å‹ã¡æ‰‹ãŒãªã„å ´åˆã¯é©å½“ã«1å€‹å–ã‚‹
      if (pileIndex === -1) {
        pileIndex = piles.findIndex(p => p > 0);
        removeCount = 1;
      }

      piles[pileIndex] -= removeCount;
      render();

      if (isGameOver()) {
        document.getElementById("message").innerText = "ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®å‹ã¡ï¼ğŸ¤–";
        return;
      }

      playerTurn = true;
      document.getElementById("message").innerText = "ã‚ãªãŸã®ç•ªã§ã™ã€‚";
    }

    function isGameOver() {
      return piles.every(p => p === 0);
    }
  </script>
</body>
</html>
